pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
 -- globals

scrollx = 0
scrolly = 0

p_udata = 0x4300
p_pixel = p_udata

-- 134.1095%
-- 132.6447%
-- 103.3478%

-->8
-- perfhud

function draw_perfhud()
	clip()

	local comp_cpu = comp_cpu or 0
 rect(1,1,64,23,6)
 rectfill(2,2,63,22,0)
 
 color(7)
 
 local cpu = stat(1)*100
 local comp_cpu = cpu - 1.6998
 
 local fps = stat(7)
 
 print("cpu  "..cpu.."%",3,3)
 print("    ("..comp_cpu.."%)",3,10)
 print("fps "..fps,3,17)
end
-->8
-- scaling

function scale_linear(y)
	return 2*(y-64)/128
end

function scale_sine(y)
 local ly = y/128
 ly -= 0.5
 ly = sin(ly*0.5)
 ly *= ly
 ly *= 0.8
 ly += 0.2
	return ly
end
-->8
-- uvs

function uv_linear(y,wrap)
	local uvy = y+scrolly
	uvy /= 2
	uvy = flr(uvy)
	uvy %= wrap
 return uvy
end

-->8
-- scalepix

draw_pal = false

function scanline(
	t_width,
	y,
	f_sc,
	f_uv,
	uv_wrap
)
	-- variable defaults
	local t_width = t_width or 8
 local y = y or 0
 local f_sc = f_sc or scale_linear
 local f_uv = f_uv or uv_linear
 local uv_wrap = uv_wrap or 8
 
 -- calculate line scale
 local scale = f_sc(y)
 
 --[[
 	only draw if the line
 	is visible
 ]]
 if scale > 0 then
 	-- scaled sprite width
  local step = 8*scale
  
  --[[
  	unscaled line coords
  	measured from -64..64
  ]]
  local lb = (t_width*4)*scale
  local la = -lb
  
  --[[
  	transform to screenspace,
  	apply scrolling and scale
  ]]
  local sxs = scrollx*scale
  local la += 64+sxs
  local lb += 64+sxs
  
  -- current texel index
  local i = 0
  
  --[[
  	iterate along the line
  	texel-by-texel
  ]]
  for x=la,lb-1,step do
   --[[
   	only draw texel
   	if it is visible
   ]]
   if(x<128 and x+step>=0) then
   	local c = 0
   	if draw_pal then
   		--[[
   			visualize texels with
   			colour field
   		]]
   		rect(x+0.5,y,x+step-0.5,y,i)
   	else
   		local ix = 8+i
   		local iy = y
   		-- draw the texel
   		sspr(ix,iy,1,1,x,y,ceil(step),1)
   	end
   end
   
   -- increment texel index
   i += 1
  end
	end
end

-->8
-- main

function _init()
	-- play background music
	music(0)
end

function _update60()
	-- left / right scroll input
	if btn(0) then
	 scrollx += 1
	end
	
	if btn(1) then
		scrollx -= 1
	end
	
	-- toggle debug visualization
	if btnp(4) then
		draw_pal = not draw_pal
	end
	
	-- integrate vertical scroll
	--scrolly = scrolly + 0.5
end

xw = 16
ys = 0
ye = 127

function _draw()
 cls()
 
 -- iterate through screen rows
 for y=ys,ye do
 	-- draw row
  scanline(
  	xw,
   y,
   scale_sine,
   uv_linear,
   11*8
  )
 end
 
 draw_perfhud()
end

__gfx__
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999407777770070000700007700007777770077777700777777007777770077777700000000000000000000000000000000000000000
00700700b3b3b3b349a99a9407000000070000700007700000077000077000700770077007000000000770000000000000000000000000000000000000000000
0007700094949494499aa99407777770077777700007700000077000077000700770077007777770000770000000000000000000000000000000000000000000
0007700049494949499aa99407777770077777700007700000077000077777700770077007777770000770000000000000000000000000000000000000000000
007007009494949449a99a9400000070070000700007700000077000077000000770077000000070000770000000000000000000000000000000000000000000
00000000292929294999999407777770070000700007700000077000077000000777777007777770000770000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56677777777777777777766500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
56666666667777666666666500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
05666666666666666666665000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00555555555555555555550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0103020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0104020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0105020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0106020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0207010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0208010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0209010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
020a010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1011120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011000000205000000020500000002050000000205000000020500000002050000000305000000030500000002050000000205000000020500000002050000000205000000020500000005050000000505000000
011000000065000000000000000024650000000000000000000000060000650000002665024000000000000000650000000000000000246500000000000000000000000600006500000026650000000000000000
011000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c600000003c60000000
__music__
01 00424344
01 00424344
01 00014344
03 00014244

