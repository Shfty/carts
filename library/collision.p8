pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- object
object = {}

function object:new(o)
	self.__index = self
	
 return setmetatable(
		o or {},
		self
	)
end

-- vector 2d
vec2 = object:new({
	x = 0,
	y = 0
})

vec2.new = function(self,x,y)
	local v = object.new(self)
	v.x = x or 0
	v.y = y or 0
	return v
end

vec2.__add = function(lhs,rhs)
	return vec2:new(
		lhs.x + rhs.x,
		lhs.y + rhs.y
	)
end

vec2.__sub = function(lhs,rhs)
	return vec2:new(
		lhs.x - rhs.x,
		lhs.y - rhs.y
	)
end

vec2.__mul = function(lhs,rhs)
	local v = vec2:new(
		lhs.x * rhs.x,
		lhs.y * rhs.y
	)
end

vec2.__div = function(lhs,rhs)
	local v = vec2:new(
		lhs.x / rhs.x,
		lhs.y / rhs.y
	)
end

vec2.lensq = function(self)
	return self.x^2+self.y^2
end

vec2.len = function(self)
 return sqrt(self:lensq())
end

-- bounding volume
b_vols = {}
b_vol = object:new()

b_vol.new = function(self,x,y,inst)
	local bv = object.new(self)
	bv.pos = vec2:new(x,y)
	return bv
end

function b_vol:_update()
end

function b_vol:_draw()
end

-- bounding box
b_box = b_vol:new()

b_box.new = function(
	self,
	x,y,
	ex,ey
)
	local bb = b_vol.new(
		self,
		x,y
	)
	
	bb.ext = vec2:new(
		ex or 4,
		ey or 4
	)
	
	add(b_vols,bb)
	
	return bb
end

function b_box:_draw()
	rect(
		self.pos.x-self.ext.x,
		self.pos.y-self.ext.y,
		self.pos.x+self.ext.x,
		self.pos.y+self.ext.y,
		7
	)
end

function b_box:isect(b)
	local mt = getmetatable(b)
	if mt == b_box then
		return i_box_box(self,b)
	end
	if mt == b_crc then
		return i_box_crc(self,b)
	end	
end

-- bounding circle
b_crc = b_vol:new()

b_crc.new = function(self,x,y,r)
	local bc = b_vol.new(self,x,y)
	bc.rad = r or 4
	add(b_vols,bc)
	return bc
end

function b_crc:_draw()
	circ(
		self.pos.x,
		self.pos.y,
		self.rad,
		7
	)
end

function b_crc:isect(b)
	local mt = getmetatable(b)
	
	if mt == b_crc then
		return i_crc_crc(self,b)
	end
	
	if mt == b_box then
		return i_box_crc(b,self)
	end
	
	return nil	
end

function i_box_box(lhs,rhs)
end

function i_box_crc(lhs,rhs)
end

function i_crc_crc(lhs,rhs)
	local d = rhs.pos-lhs.pos
	local r = lhs.rad+rhs.rad
	return d:len() <= r
end
-->8
box_a = b_box:new(60,60)
box_b = b_box:new(68,68)
crc_a = b_crc:new(96,32)
crc_b = b_crc:new(32,32)

function _update60()
	if btnp(0) then
  crc_a.pos.x -= 1
	end
	
	if btnp(1) then
		crc_a.pos.x += 1
	end
	
	if btnp(2) then
		crc_a.pos.y -= 1
	end
	
	if btnp(3) then
		crc_a.pos.y += 1
	end
	
	for vol in all(b_vols) do
		vol:_update()
	end
end

function _draw()
	cls()
	
	for vol in all(b_vols) do
		vol:_draw()
	end
	
	local isect = crc_a:isect(crc_b)
	print(isect)
end
__label__
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
88888777777888eeeeee888888888888888888888888888888888888888888888888888888888888888ff8ff8888228822888222822888888822888888228888
8888778887788ee88eee88888888888888888888888888888888888888888888888888888888888888ff888ff888222222888222822888882282888888222888
888777878778eeee8eee88888e88888888888888888888888888888888888888888888888888888888ff888ff888282282888222888888228882888888288888
888777878778eeee8eee8888eee8888888888888888888888888888888888888888888888888888888ff888ff888222222888888222888228882888822288888
888777878778eeee8eee88888e88888888888888888888888888888888888888888888888888888888ff888ff888822228888228222888882282888222288888
888777888778eee888ee888888888888888888888888888888888888888888888888888888888888888ff8ff8888828828888228222888888822888222888888
888777777778eeeeeeee888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
55555e555e5e5e555e5e5e555555566655655555577755555b555b5555b55bbb5b5555b55b5b55b55b5b5b5b5b555b5557555656555755555555555555555555
55555e555e5e5e555eee5e555555565655655555555555555b555bb555b55b5b5bb555b55bbb55b55bbb5bb55b555bb557555665555755555555555555555555
55555e555e5e5e555e5e5e555555565655655555577755555b5b5b5555b55b5b5b5555b55b5b55b55b5b5b5b5b555b5557555656555755555555555555555555
55555eee5ee555ee5e5e5eee5555565655655555555555555bbb5bbb55b55b5b5bbb55b55b5b55b55b5b5bbb5bbb5bbb55755666557555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5eee55555666566655555555555555555666555555665666556655555eee5e5e5eee5ee5555555555555555555555555555555555555555555555555
555555e55e55555556665565555557775777555556565555565556565655555555e55e5e5e555e5e555555555555555555555555555555555555555555555555
555555e55ee5555556565565555555555555555556655555565556655655555555e55eee5ee55e5e555555555555555555555555555555555555555555555555
555555e55e55555556565565555557775777555556565555565556565655555555e55e5e5e555e5e555555555555555555555555555555555555555555555555
55555eee5e55555556565565555555555555555556665666556656565566555555e55e5e5eee5e5e555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555eee5eee5eee5e5e5eee5ee5555556665555556656665566555555665666556655755566566656555666555556665575555555555555555555555555
555555555e5e5e5555e55e5e5e5e5e5e555555655555565556565655555556555656565557555655565556555655555556565557555555555555555555555555
555555555ee55ee555e55e5e5ee55e5e555555655555565556655655555556555665565557555666566556555665555556655557555555555555555555555555
555555555e5e5e5555e55e5e5e5e5e5e555555655555565556565655555556555656565557555556565556555655557556565557555555555555555555555555
555555555e5e5eee55e555ee5e5e5e5e555556665666556656565566566655665656556655755665566656665655575556665575555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5ee55ee55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e5e5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555ee55e5e5e5e5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e5e5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5e5e5eee5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5eee55555666566655555555555555555666555556665566565655555eee5e5e5eee5ee5555555555555555555555555555555555555555555555555
555555e55e55555556665565555557775777555556565555565656565656555555e55e5e5e555e5e555555555555555555555555555555555555555555555555
555555e55ee5555556565565555555555555555556655555566556565565555555e55eee5ee55e5e555555555555555555555555555555555555555555555555
555555e55e55555556565565555557775777555556565555565656565656555555e55e5e5e555e5e555555555555555555555555555555555555555555555555
55555eee5e55555556565565555555555555555556665666566656655656555555e55e5e5eee5e5e555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
555555555eee5eee5eee5e5e5eee5ee5555556665555566655665656555555665666556655755666555555665666565556665575555555555555555555555555
555555555e5e5e5555e55e5e5e5e5e5e555555655555565656565656555556555656565557555656555556555655565556555557555555555555555555555555
555555555ee55ee555e55e5e5ee55e5e555555655555566556565565555556555665565557555665555556665665565556655557555555555555555555555555
555555555e5e5e5555e55e5e5e5e5e5e555555655555565656565656555556555656565557555656557555565655565556555557555555555555555555555555
555555555e5e5eee55e555ee5e5e5e5e555556665666566656655656566655665656556655755666575556655666566656555575555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5ee55ee55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e5e5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555ee55e5e5e5e5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e555e5e5e5e5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5e5e5eee5555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5ee55e1555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e517155555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ee55e5e517715555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e517771555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e517777155555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555517711555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555551171555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5ee555ee5eee5eee55ee5ee5555556665555566655665656555556665566565655755655565655665555566656565566557555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555555655555565656565656555556565656565657555655565656555555565656565655555755555555555555555555
5ee55e5e5e5e5e5555e555e55e5e5e5e555555655555566556565565555556655656556557555655566656665555566556665666555755555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555555655555565656565656555556565656565657555655565655565575565656565556555755555555555555555555
5e5555ee5e5e55ee55e55eee5ee55e5e555556665666566656655656566656665665565655755666565656655755565656565665557555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5ee55ee555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ee55e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5eee55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5ee555ee5eee5eee55ee5ee5555556665555566655665656555555665666556655755655565655665555566656565566557555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555555655555565656565656555556555656565557555655565656555555565656565655555755555555555555555555
5ee55e5e5e5e5e5555e555e55e5e5e5e555555655555566556565565555556555665565557555655566656665555566556665666555755555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555555655555565656565656555556555656565557555655565655565575565656565556555755555555555555555555
5e5555ee5e5e55ee55e55eee5ee55e5e555556665666566656655656566655665656556655755666565656655755565656565665557555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5ee55ee555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ee55e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5eee55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5ee555ee5eee5eee55ee5ee5555556665555556656665566555555665666556655755655565655665555566656565566557555555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555555655555565556565655555556555656565557555655565656555555565656565655555755555555555555555555
5ee55e5e5e5e5e5555e555e55e5e5e5e555555655555565556655655555556555665565557555655566656665555566556665666555755555555555555555555
5e555e5e5e5e5e5555e555e55e5e5e5e555555655555565556565655555556555656565557555655565655565575565656565556555755555555555555555555
5e5555ee5e5e55ee55e55eee5ee55e5e555556665666556656565566566655665656556655755666565656655755565656565665557555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5555ee55ee5eee5e5555555665555555555555566656565566555556665566556655555655565655665555566655665566555555555555555555555555
55555e555e5e5e555e5e5e5555555656555557775555565656565655555556565656565555555655565656555555565656565655555555555555555555555555
55555e555e5e5e555eee5e5555555656555555555555566556665666555556665656566657775655566656665555566656565666555555555555555555555555
55555e555e5e5e555e5e5e5555555656555557775555565656565556555556555656555655555655565655565555565556565556555555555555555555555555
55555eee5ee555ee5e5e5eee55555666555555555555565656565665557556555665566555555666565656655575565556655665555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555eee5eee5eee5e5e5eee5ee55555566555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5e5e5555e55e5e5e5e5e5e5555565655555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555ee55ee555e55e5e5ee55e5e5555565655555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5e5e5555e55e5e5e5e5e5e5555565655555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555e5e5eee55e555ee5e5e5e5e5555566655555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5ee55ee555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5ee55e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5e555e5e5e5e55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
5eee5e5e5eee55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
55555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555555
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888
82888222822882228888822882828222888282288222822288888888888888888888888888888888888888888282822282228882822282288222822288866688
82888828828282888888882882828282882888288288828288888888888888888888888888888888888888888282828288828828828288288282888288888888
82888828828282288888882882228222882888288222828288888888888888888888888888888888888888888222822288828828822288288222822288822288
82888828828282888888882888828282882888288882828288888888888888888888888888888888888888888882888288828828828288288882828888888888
82228222828282228888822288828222828882228222822288888888888888888888888888888888888888888882888288828288822282228882822288822288
88888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888

