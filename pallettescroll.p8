pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
 -- lib

function rspr(x,y)
	pix = {}

	start = (y*16*4)+(x*4)

	for i=start,start+15 do
		b1 = flr(peek(i) % 16)
		b2 = flr(peek(i) / 16)
		add(pix, b1)
		add(pix, b2)
	end
	
	return pix
end

-->8
-- main

draw_palfield = true
 
function _init()
	palt(1, false)
end

scrollx = 0
scrolly = 0
function _update60()
	if btn(0) then
	 scrollx += 1
	end
	
	if btn(1) then
		scrollx -= 1
	end
	
	if btnp(4) then
		draw_palfield = not draw_palfield
	end
	
	scrolly = scrolly - 1
end

function _draw()
 cls(8)
 
 for y=0,127 do
 	if not draw_palfield then
  	pix = rspr(1,uv(y))
   for x=0,15 do
   	pal(x,pix[x+1])
   end
  end
  
  clip(0,y,128,y+1)
  draw_scan(y)
 end
 
 pal()
 clip()
end

function uv(y)
 return flr((scrolly+y)/2)%8
end

seg = 128/16
ext = seg/2
function draw_scan(y)
 scale = scale_sine(y)
 ext_s = ext*scale
 if scale > 0 then
 	for i=0,15 do
 		ctr = (i*seg)+ext
 		ctr += scrollx
 		ctr -= 64
 		ctr *= scale
 		ctr += 64.5
 		
   la = ctr-ext_s
   lb = ctr+ext_s-1
 		
 		if la < 128 and lb >= 0 then
 			line(la,y,lb,y,i)
 		end
 	end
	end
end

rec = 1/128
function scale_linear(y)
	return 2*(y-64)*rec
end

function scale_sine(y)
 ly = y*rec
 ly -= 0.5
 ly = sin(ly*0.5)
 ly *= ly
 ly = max(ly, 0.125)
	return ly
end
__gfx__
00000000b7b7b7b74444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003b3b3b3b4999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3b3b3b349a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700094949494499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700049494949499aa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007009494949449a99a9400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000292929294999999400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000424242424444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0123456789abcdef0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
